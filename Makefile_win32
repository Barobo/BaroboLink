#This makefile is for MSYS/MinGW systems
MOBOT_PREFIX=/home/dko/sys
MOBOTDIR=/d/Projects/iMobot_gumstix_api/libimobotcomms
SCIPREFIX=/d/Projects/scintilla
CC=g++
CFLAGS=-c -g `pkg-config --cflags gtk+-2.0` `pkg-config --cflags gmodule-2.0` \
       -I$(MOBOT_PREFIX)/include \
       -I. \
       -I$(SCIPREFIX)/include \
       -U_WIN32 -D_MSYS -Wl,--export-dynamic
#LIBS=`pkg-config --libs gtk+-2.0` -L. -lmobot -linterface
LIBS= \
      -L$(SCIPREFIX)/lib \
      -lscintilla \
      `pkg-config --libs gtk+-2.0` \
      `pkg-config --libs gmodule-2.0` \
      -L. \
      -L$(MOBOT_PREFIX)/lib \
      -lmobot -linterface -lpthread -mwindows -lws2_32

#OBJS=RoboMancer.o  connectHandlers.o  gait.o  menuHandlers.o  movementFunctions.o  movementHandlers.o
OBJS=connectDialog.o RoboMancer.o configFile.o RobotManager.o RecordMobot.o programDialog.o controlDialog.o teachingDialog.o mobot++_wrapper.o commsHandler.o
HEADERS=RoboMancer.h

#all:libmobot.a $(OBJS) RoboMancer
all:$(OBJS) RoboMancer 

MOBOTDIR=/d/Projects/iMobot_gumstix_api/libimobotcomms

mobot.dll:$(MOBOTDIR)/Release/mobot.dll
	cp $(MOBOTDIR)/Release/mobot.dll mobot.dll

mobot.lib:$(MOBOTDIR)/Release/mobot.lib
	cp $(MOBOTDIR)/Release/mobot.lib mobot.lib

mobot.h:$(MOBOTDIR)/mobot.h
	cp $(MOBOTDIR)/mobot.h mobot.h

mobot.def:mobot.dll mobot.lib
	pexports mobot.dll | sed 's/^_//' > mobot.def

libmobot.a:mobot.def mobot.dll mobot++_wrapper.o
	dlltool --input-def mobot.def --dllname mobot.dll --output-lib libmobot.a -k
	ar -r libmobot.a mobot++_wrapper.o
	ranlib libmobot.a

.cpp.o: mobot.h
	$(CC) $(CFLAGS) $<

interface.o:interface/interface.glade
	ld -r -b binary -o interface.o interface/interface.glade

libinterface.a:interface.o
	ar rcs libinterface.a interface.o

RoboMancer:$(OBJS) $(HEADERS) libinterface.a libmobot.a 
	$(CC) -v $(OBJS) $(LIBS) -o RoboMancer

clean:
	rm -rf RoboMancer $(OBJS) libinterface.a interface.o 
	#rm -rf RoboMancer $(OBJS) libinterface.a interface.o libmobot.a mobot.def mobot.lib mobot.dll

